<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>متجر أدو — تخصيص باقة (مع صور واقعية)</title>
<style>
  body{font-family: "Tajawal", Arial, sans-serif; background:#fff6fb; color:#3c3c3c; margin:0; padding:24px}
  .container{max-width:980px;margin:auto}
  h1{color:#b83b79}
  .row{display:flex; gap:18px; flex-wrap:wrap}
  .panel{background:#fff;border-radius:12px;padding:12px;box-shadow:0 8px 20px rgba(0,0,0,.06);flex:1}
  .preview-img{width:100%;height:auto;border-radius:10px;border:1px solid #f2cfe0; display:block}
  label{display:block;margin-top:8px;font-weight:700}
  select,input[type=number]{width:100%;padding:8px;border-radius:8px;border:1px solid #f0cfe0}
  .btn{background:#b83b79;color:#fff;padding:10px 12px;border-radius:10px;border:0;cursor:pointer}
  .mini{color:#7a7a7a;font-size:13px}
  .summary{margin-top:10px;font-weight:700;color:#a33770}
  @media(max-width:820px){ .row{flex-direction:column} }
</style>
</head>
<body>
  <div class="container">
    <h1>صفحة تخصيص الباقة — صور واقعية</h1>
    <div class="row">
      <div style="flex:1;min-width:320px" class="panel">
        <label>عدد الورود</label>
        <input type="number" id="qty" value="12" min="5" max="100" />
        <label>لون الورد</label>
        <select id="roseColor">
          <option value="pink">وردي</option>
          <option value="red">أحمر</option>
          <option value="white">أبيض</option>
          <option value="yellow">أصفر</option>
          <option value="mix">مُختلط</option>
        </select>
        <label>لون التغليف</label>
        <select id="wrapColor">
          <option value="wrap-pink">وردي</option>
          <option value="wrap-brown">بني</option>
          <option value="wrap-white">أبيض</option>
          <option value="wrap-clear">شفاف</option>
        </select>

        <p class="mini">ملاحظة: النظام يبحث عن ملف بصورة باسم: <code>rose-<span id="previewPattern">pink</span>-wrap-pink-12.jpg</code></p>

        <div style="margin-top:12px">
          <button class="btn" id="updateBtn">تحديث المعاينة</button>
        </div>
      </div>

      <div style="flex:1;min-width:320px" class="panel">
        <div id="imageBox">
          <img id="previewPhoto" class="preview-img" src="images/placeholder.jpg" alt="معاينة الباقة" />
        </div>
        <div class="summary" id="summaryText">12 وردة — وردي — تغليف وردي — الإجمالي: 24,000 د.ع</div>
      </div>
    </div>
  </div>

<script>
  const PRICE = 2000;
  const previewPhoto = document.getElementById('previewPhoto');
  const qtyInput = document.getElementById('qty');
  const colorSel = document.getElementById('roseColor');
  const wrapSel = document.getElementById('wrapColor');
  const summary = document.getElementById('summaryText');
  const previewPattern = document.getElementById('previewPattern');

  function fmt(num){ return num.toLocaleString('ar-IQ'); }

  function buildFilename(){
    const color = colorSel.value; // ex: pink, red, mix, white
    const wrap = wrapSel.value;   // ex: wrap-pink, wrap-brown
    const qty = parseInt(qtyInput.value||12);
    // Normalize names (تستخدمها لاسم الملف)
    // filename pattern: rose-<color>-<wrap>-<qty>.jpg
    // قبل الحفظ تأكد أن ملفات الصور مسماة بنفس النمط
    const wrapShort = wrap.replace('wrap-','');
    return `images/rose-${color}-wrap-${wrapShort}-${qty}.jpg`;
  }

  async function fileExists(url){
    // نحاول طلب رأس الملف؛ لكن بعض المتصفحات تمنع الطلبات محلياً بدون سيرفر
    try{
      const resp = await fetch(url, { method:'HEAD' });
      return resp.ok;
    }catch(e){
      // لو فشل الطلب (ملف محلي بدون خادم) نقول إن الملف غير موجود،
      // لكن غالباً هذا يعني افتح الملف عبر خادم محلي لتجربة صحيحة.
      return false;
    }
  }

  async function updatePreview(){
    const file = buildFilename();
    previewPattern.textContent = `${colorSel.value}`;
    const qty = parseInt(qtyInput.value||12);
    const total = qty * PRICE;
    summary.textContent = `${qty} وردة — ${colorSel.options[colorSel.selectedIndex].text} — ${wrapSel.options[wrapSel.selectedIndex].text} — الإجمالي: ${fmt(total)} د.ع`;

    // إذا كان الملف موجوداً احمله، وإلا جرب صورة بديلة أو placeholder
    const exists = await fileExists(file);
    if(exists){
      previewPhoto.src = file;
      previewPhoto.alt = `باقة ${colorSel.options[colorSel.selectedIndex].text} — ${qty} وردة`;
    } else {
      // جرّب صورة عامة للون الورد فقط (بدون تغليف) إن وُجدت
      const fallback = `images/rose-${colorSel.value}-default.jpg`; // اختياري
      const fbExists = await fileExists(fallback);
      if(fbExists){ previewPhoto.src = fallback; previewPhoto.alt = 'صورة بديلة' }
      else { previewPhoto.src = 'images/placeholder.jpg'; previewPhoto.alt = 'صورة افتراضية' }
    }
  }

  // تطبيق حدث
  document.getElementById('updateBtn').addEventListener('click', updatePreview);
  qtyInput.addEventListener('change', updatePreview);
  colorSel.addEventListener('change', updatePreview);
  wrapSel.addEventListener('change', updatePreview);

  // تحديث أولي
  updatePreview();
</script>
</body>
</html>
