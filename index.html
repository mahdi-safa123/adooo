<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>متجر أدو | باقات ورد</title>
<style>
  :root{
    --pink:#f8cfe1;
    --pink-100:#ffe9f3;
    --pink-200:#ffd1e5;
    --pink-300:#ffb9d6;
    --pink-600:#d85697;
    --rose:#ff6f91;
    --text:#3c3c3c;
    --muted:#6b6b6b;
    --white:#fff;
    --bg:#fff7fb;
    --paper-brown:#c49a6c;
    --paper-white:#f3f3f3;
    --paper-pink:#f7c6dc;
    --paper-clear:#e8f0ff;
    --gold:#d4af37;
    --silver:#c0c0c8;
    --green:#2f7d32;
    --shadow: 0 8px 24px rgba(0,0,0,.08);
    --radius:16px;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: "Tajawal", system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Noto Naskh Arabic", sans-serif;
    color:var(--text);
    background:
      radial-gradient(1200px 1200px at 90% -20%, #ffd9ee 0, transparent 60%),
      radial-gradient(900px 900px at -10% 120%, #ffe5f3 0, transparent 55%),
      var(--bg);
  }
  header{
    position:sticky; top:0; z-index:20;
    backdrop-filter:saturate(140%) blur(8px);
    background:rgba(255,249,253,.7);
    border-bottom:1px solid #f5ddea;
  }
  .nav{
    display:flex; align-items:center; gap:16px; padding:12px 20px; max-width:1200px; margin:auto;
  }
  .logo{
    display:flex; align-items:center; gap:10px; font-weight:800; color:#b83b79; letter-spacing:.4px;
  }
  .logo .emoji{
    width:36px; height:36px; display:grid; place-items:center; border-radius:50%;
    background:conic-gradient(from 0deg, #ff9fc4, #ffd1e4, #ff9fc4);
    box-shadow: var(--shadow);
  }
  .nav a{color:var(--text); text-decoration:none; padding:8px 12px; border-radius:12px}
  .nav a.active, .nav a:hover{background:var(--pink-100); color:#a33770}
  .cta{margin-inline-start:auto}
  .btn{
    appearance:none; border:0; cursor:pointer;
    padding:10px 16px; border-radius:12px; background:#b83b79; color:#fff; font-weight:700;
    box-shadow: var(--shadow);
  }
  main{max-width:1200px; margin:24px auto; padding:0 16px}

  /* Hero */
  .hero{
    display:grid; grid-template-columns:1.2fr .8fr; gap:20px; align-items:center;
    padding:20px; border-radius:var(--radius);
    background:linear-gradient(180deg,#fff,#fff0), var(--pink-100);
    box-shadow: var(--shadow);
  }
  .hero h1{margin:.2em 0; color:#a33770; font-size:clamp(26px,3vw,36px)}
  .hero p{color:var(--muted)}
  .hero .stamp{
    display:inline-flex; align-items:center; gap:8px; background:#fff; padding:6px 12px; border-radius:999px; border:1px dashed #e8a8c7;
  }
  /* Cute doodles */
  .doodles{
    position:absolute; inset:0; pointer-events:none; opacity:.18;
    background:
      radial-gradient(12px 12px at 12% 30%, #ff8db3 20%, transparent 21%) no-repeat,
      radial-gradient(12px 12px at 80% 20%, #ff8db3 20%, transparent 21%) no-repeat,
      radial-gradient(10px 10px at 90% 80%, #ffa3c6 20%, transparent 21%) no-repeat,
      radial-gradient(8px 8px at 5% 85%, #ffb6d5 20%, transparent 21%) no-repeat;
  }

  /* Cards grid */
  .grid{display:grid; grid-template-columns:repeat(auto-fill,minmax(230px,1fr)); gap:16px; margin-top:20px}
  .card{
    background:#fff; border-radius:18px; overflow:hidden; box-shadow: var(--shadow); position:relative;
    border:1px solid #ffe1f0;
  }
  .card .img{aspect-ratio:1/1; display:grid; place-items:center; background:linear-gradient(180deg,#fff,#ffeaf3)}
  .card .body{padding:12px 14px}
  .price{color:#a33770; font-weight:800}
  .chip{font-size:12px; background:#fff2f8; color:#b83b79; padding:4px 8px; border-radius:10px; border:1px solid #ffd3e8}

  /* Bouquet renderer (SVG) */
  .bouquet{
    width:100%; height:100%;
  }
  /* Customizer */
  .section{
    margin-top:28px; padding:18px; background:#fff; border-radius:18px; box-shadow: var(--shadow); border:1px solid #ffe1f0; position:relative;
  }
  .section h2{margin:0 0 10px; color:#a33770}
  .row{display:grid; grid-template-columns:1fr 1fr; gap:16px}
  .field{display:flex; flex-direction:column; gap:8px}
  label{font-weight:700}
  select, input[type="number"]{
    padding:10px 12px; border-radius:12px; border:1px solid #f0cfe0; background:#fff; outline:none;
  }
  .swatches{display:flex; flex-wrap:wrap; gap:8px}
  .swatch{
    width:32px; height:32px; border-radius:999px; border:2px solid #fff; outline:2px solid rgba(0,0,0,.06); cursor:pointer;
    position:relative;
  }
  .swatch[data-active="true"]::after{
    content:"✓"; position:absolute; inset:0; display:grid; place-items:center; color:#fff; font-weight:900; text-shadow:0 1px 2px rgba(0,0,0,.25);
  }
  .preview{
    display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-top:16px;
  }
  .panel{background:#fff; border:1px solid #ffe1f0; border-radius:18px; padding:12px; box-shadow: var(--shadow)}
  .totals{display:flex; align-items:center; justify-content:space-between; padding:12px; background:#fff7fb; border:1px dashed #f1b4d0; border-radius:12px}
  .mini{font-size:12px; color:var(--muted)}
  .actions{display:flex; gap:10px; flex-wrap:wrap}

  /* Cart & checkout (drawer) */
  .drawer{
    position:fixed; inset-block:0; inset-inline-end:-420px; width:min(420px, 100%); background:#fff; box-shadow:-12px 0 32px rgba(0,0,0,.15);
    transition:transform .35s ease, inset-inline-end .35s ease; padding:18px; z-index:50; border-inline-start:1px solid #ffe1f0;
  }
  .drawer.open{inset-inline-end:0}
  .drawer h3{margin-top:0; color:#a33770}
  .line{display:flex; align-items:center; justify-content:space-between; padding:8px 0; border-bottom:1px dashed #f3cfe1}
  .pay-logos{display:flex; align-items:center; gap:8px; flex-wrap:wrap}
  .badge{padding:6px 10px; border-radius:10px; background:#f5f5f7; border:1px solid #ececec; font-size:12px}

  /* Support button */
  .support{
    position:fixed; inset-inline-start:16px; inset-block-end:16px; z-index:40;
  }
  .fab{
    width:54px; height:54px; border-radius:999px; background:#b83b79; color:#fff; display:grid; place-items:center; box-shadow: var(--shadow); cursor:pointer;
  }
  .chat{
    position:fixed; inset-inline-start:16px; inset-block-end:84px; width:320px; background:#fff; border:1px solid #ffd3e8; border-radius:16px; box-shadow: var(--shadow); display:none;
  }
  .chat.open{display:block}
  .chat header{position:relative; border:0; background:var(--pink-200); border-bottom:1px solid #f2bfd8; border-radius:16px 16px 0 0}
  .chat header .title{padding:10px 12px; font-weight:800; color:#7a2757}
  .chat .messages{max-height:220px; overflow:auto; padding:10px}
  .msg{background:#fff2f8; padding:8px 10px; border-radius:10px; margin:6px 0; font-size:14px}
  .chat form{display:flex; gap:6px; padding:10px}
  .chat input{flex:1; padding:10px; border:1px solid #ffd3e8; border-radius:10px}
  .chat button{padding:10px 12px; border:0; border-radius:10px; background:#b83b79; color:#fff}

  footer{margin:40px auto 80px; max-width:1200px; padding:0 16px; color:var(--muted)}
  .foot{
    display:grid; grid-template-columns:1fr 1fr; gap:16px; background:#fff; border:1px solid #ffe1f0; border-radius:16px; padding:16px; box-shadow:var(--shadow)
  }

  @media (max-width:900px){
    .hero{grid-template-columns:1fr}
    .row{grid-template-columns:1fr}
    .preview{grid-template-columns:1fr}
  }
</style>
</head>
<body>

<header>
  <nav class="nav">
    <div class="logo"><span class="emoji">🌷</span> متجر أدو</div>
    <a href="#ready" class="active">الباقات</a>
    <a href="#custom">مخصص</a>
    <a href="#support">الدعم</a>
    <a href="#pay">الدفع</a>
    <div class="cta"><button class="btn" id="openCart">سلة المشتريات 🧺</button></div>
  </nav>
</header>

<main>
  <section class="hero">
    <div style="position:relative">
      <div class="doodles"></div>
      <span class="stamp">2000 دينار للوردة</span>
      <h1>باقات ورد كيوت… وتغليفات متنوعة وواقعية</h1>
      <p>اختر من تشكيلتنا الجاهزة أو صمّم باقتك الخاصة: عدد الورد، ألوان الورد، وألوان التغليف مع معاينة فورية.</p>
      <div class="actions">
        <a href="#ready" class="btn" style="background:#a33770">تسوق الباقات</a>
        <a href="#custom" class="btn" style="background:#ff77a6">صمّم باقتك</a>
      </div>
    </div>
    <!-- معاينة كبيرة كرتونية لطيفة -->
    <div class="panel">
      <svg viewBox="0 0 200 200" class="bouquet" aria-label="بوكيه">
        <!-- سيقان -->
        <g opacity=".8">
          <rect x="96" y="80" width="4" height="90" fill="#2e7d32"/>
          <rect x="90" y="85" width="3" height="85" fill="#3d8a40"/>
          <rect x="107" y="88" width="3" height="82" fill="#3d8a40"/>
        </g>
        <!-- لفّة تغليف وردية -->
        <path d="M60,120 Q100,90 140,120 L120,170 Q100,180 80,170 Z" fill="#f7c6dc" stroke="#e8a8c7"/>
        <!-- شريط -->
        <circle cx="100" cy="155" r="10" fill="#d4af37"/>
        <rect x="92" y="148" width="16" height="4" rx="2" fill="#d4af37"/>
        <!-- ورود -->
        <g id="hero-roses"></g>
        <script>
          // رسم ورود لطيفة
          const container=document.currentScript.previousElementSibling;
          for(let i=0;i<11;i++){
            const cx=70+Math.cos(i/11*6.28)*28 + (i%3?15:0);
            const cy=95+Math.sin(i/11*6.28)*18 + (i%2?6:0);
            const color=['#ff769f','#ffc6dc','#ffe6ef','#ff96b6'][i%4];
            const g=document.createElementNS('http://www.w3.org/2000/svg','g');
            const c=document.createElementNS('http://www.w3.org/2000/svg','circle');
            c.setAttribute('cx',cx); c.setAttribute('cy',cy); c.setAttribute('r',12);
            c.setAttribute('fill',color);
            const swirl=document.createElementNS('http://www.w3.org/2000/svg','path');
            swirl.setAttribute('d',`M ${cx-6} ${cy} q 6 -8 12 0 q -6 8 -12 0`);
            swirl.setAttribute('stroke','#b83b79'); swirl.setAttribute('fill','none'); swirl.setAttribute('opacity','.35');
            g.append(c,swirl); container.appendChild(g);
          }
        </script>
      </svg>
    </div>
  </section>

  <!-- الباقات الجاهزة -->
  <section id="ready" class="section">
    <h2>باقات جاهزة متنوعة</h2>
    <div class="grid" id="readyGrid"></div>
  </section>

  <!-- صفحة التخصيص -->
  <section id="custom" class="section">
    <h2>خصّص باقتك</h2>
    <div class="row">
      <div class="field">
        <label>عدد الورود</label>
        <input type="number" id="qty" min="5" max="100" step="1" value="12" />
        <span class="mini">السعر يُحتسب تلقائياً (2000 دينار للوردة).</span>
      </div>
      <div class="field">
        <label>لون الشريط</label>
        <select id="ribbon">
          <option value="gold">ذهبي</option>
          <option value="silver">فضي</option>
          <option value="pink">وردي</option>
          <option value="white">أبيض</option>
        </select>
      </div>
      <div class="field">
        <label>ألوان الورد (اختر حتى 3)</label>
        <div class="swatches" id="roseSwatches"></div>
      </div>
      <div class="field">
        <label>لون التغليف</label>
        <select id="wrap">
          <option value="paper-pink">وردي</option>
          <option value="paper-brown">بني</option>
          <option value="paper-white">أبيض</option>
          <option value="paper-clear">شفاف</option>
        </select>
      </div>
    </div>

    <div class="preview">
      <div class="panel">
        <strong>معاينة الباقة</strong>
        <div style="aspect-ratio:1/1; margin-top:8px; display:grid; place-items:center;">
          <svg viewBox="0 0 200 220" class="bouquet" id="previewSVG" aria-label="معاينة مخصصة">
            <!-- stems -->
            <g id="stems"></g>
            <!-- wrap -->
            <path id="wrapPath" d="M50,140 Q100,100 150,140 L125,200 Q100,210 75,200 Z" fill="#f7c6dc" stroke="#e8a8c7"/>
            <!-- ribbon -->
            <g id="ribbonG">
              <circle cx="100" cy="182" r="10" fill="#d4af37"/>
              <rect x="92" y="175" width="16" height="4" rx="2" fill="#d4af37"/>
            </g>
            <!-- roses -->
            <g id="roses"></g>
          </svg>
        </div>
      </div>
      <div class="panel">
        <strong>ملخص الطلب</strong>
        <div class="totals" style="margin-top:10px">
          <div>
            <div>عدد الورود: <b id="summaryQty">12</b></div>
            <div class="mini">ألوان الورد: <span id="summaryColors"></span></div>
            <div class="mini">لون التغليف: <span id="summaryWrap">وردي</span> — الشريط: <span id="summaryRibbon">ذهبي</span></div>
          </div>
          <div>
            <div class="price" id="totalPrice">24,000 د.ع</div>
            <div class="mini">2000 د.ع × <span id="miniQty">12</span></div>
          </div>
        </div>
        <div class="actions" style="margin-top:10px">
          <button class="btn" id="addToCart">أضف للسلة</button>
          <button class="btn" style="background:#ff77a6" id="buyNow">اشتري الآن</button>
        </div>
        <p class="mini" style="margin-top:8px"><span class="chip">دفع إلكتروني آمن</span> فيزا / ماستركارد / باي بال / تحويل محلي</p>
      </div>
    </div>
  </section>
</main>

<!-- سلة + الدفع -->
<aside class="drawer" id="cartDrawer" aria-label="السلة والدفع">
  <h3>سلة المشتريات</h3>
  <div id="cartLines"></div>
  <div class="line"><strong>الإجمالي</strong><strong id="cartTotal">0 د.ع</strong></div>

  <h4 id="pay">الدفع</h4>
  <div class="pay-logos">
    <span class="badge">💳 VISA</span>
    <span class="badge">💳 MasterCard</span>
    <span class="badge">🅿️ PayPal</span>
    <span class="badge">🏦 تحويل محلي</span>
  </div>

  <form id="checkout" style="margin-top:12px">
    <div class="field"><label>الاسم الكامل</label><input required placeholder="اسمك" /></div>
    <div class="field"><label>رقم الهاتف</label><input required type="tel" placeholder="07xxxxxxxx" /></div>
    <div class="field"><label>العنوان</label><input required placeholder="المدينة، الشارع…" /></div>
    <button class="btn" type="submit" style="width:100%; margin-top:10px">إتمام الطلب</button>
  </form>
  <p class="mini">هذا نموذج تجريبي. عند الربط ببوابة دفع حقيقية سيتم تحويلك لصفحة الدفع الآمنة.</p>
</aside>

<!-- دعم -->
<div class="support" id="support">
  <div class="fab" id="toggleChat">💬</div>
  <div class="chat" id="chatBox" aria-live="polite">
    <header><div class="title">دعم متجر أدو</div></header>
    <div class="messages" id="messages">
      <div class="msg">مرحباً! كيف نقدر نساعدك؟ 🌷</div>
    </div>
    <form id="chatForm">
      <input id="chatInput" placeholder="اكتب رسالتك…" />
      <button>إرسال</button>
    </form>
  </div>
</div>

<footer>
  <div class="foot">
    <div>© متجر أدو — كل الحقوق محفوظة.</div>
    <div style="text-align:end">سعر الوردة: 2000 دينار — تغليفات وألوان متعددة.</div>
  </div>
</footer>

<script>
  //— إعدادات عامة
  const PRICE_PER_ROSE = 2000;

  //— توليد باقات جاهزة برسوم SVG مختلفة التغليف/الأشرطة
  const readyData = [
    { title:'باقة وردية بشريط سماوي', colors:['#ffa3c6'], wrap:'paper-pink', ribbon:'pink' },
    { title:'باقة حمراء بتغليف بني', colors:['#ff4b6e'], wrap:'paper-brown', ribbon:'gold' },
    { title:'باقة بيضاء بتغليف شفاف', colors:['#fff5f7'], wrap:'paper-clear', ribbon:'silver' },
    { title:'باقة مختلطة (وردي/أبيض)', colors:['#ffa3c6','#fff5f7'], wrap:'paper-white', ribbon:'gold' },
    { title:'باقة مشكّلة (وردي/أحمر/أبيض)', colors:['#ff6f91','#ffa3c6','#fff5f7'], wrap:'paper-pink', ribbon:'gold' },
    { title:'باقة بنفسجية', colors:['#c083d3'], wrap:'paper-white', ribbon:'silver' },
  ];

  function wrapColor(key){
    return {
      'paper-pink':'#f7c6dc',
      'paper-brown':'#c49a6c',
      'paper-white':'#f3f3f3',
      'paper-clear':'#e8f0ff'
    }[key] || '#f7c6dc';
  }
  function ribbonFill(key){
    return { gold:'#d4af37', silver:'#c0c0c8', pink:'#ff77a6', white:'#ffffff' }[key] || '#d4af37';
  }

  function makeBouquetSVG({colors, wrap='paper-pink', ribbon='gold'}, qty=15){
    // SVG بطاقة
    const svg = document.createElementNS('http://www.w3.org/2000/svg','svg');
    svg.setAttribute('viewBox','0 0 200 220'); svg.classList.add('bouquet');
    // stems
    const stems = document.createElementNS(svg.namespaceURI,'g');
    for(let i=0;i<Math.min(qty,18);i++){
      const x = 70 + (i%6)*6 + Math.random()*6;
      const r = document.createElementNS(svg.namespaceURI,'rect');
      r.setAttribute('x', x); r.setAttribute('y', 110+Math.random()*10);
      r.setAttribute('width', 2); r.setAttribute('height', 80+Math.random()*10);
      r.setAttribute('fill', ['#2e7d32','#3d8a40'][i%2]);
      stems.appendChild(r);
    }
    svg.appendChild(stems);
    // wrap
    const path = document.createElementNS(svg.namespaceURI,'path');
    path.setAttribute('d','M50,140 Q100,100 150,140 L125,200 Q100,210 75,200 Z');
    path.setAttribute('fill', wrapColor(wrap));
    path.setAttribute('stroke', '#e8a8c7');
    svg.appendChild(path);
    // ribbon
    const rg = document.createElementNS(svg.namespaceURI,'g');
    const circ = document.createElementNS(svg.namespaceURI,'circle');
    circ.setAttribute('cx','100'); circ.setAttribute('cy','182'); circ.setAttribute('r','10');
    circ.setAttribute('fill', ribbonFill(ribbon));
    const bar = document.createElementNS(svg.namespaceURI,'rect');
    bar.setAttribute('x','92'); bar.setAttribute('y','175'); bar.setAttribute('width','16'); bar.setAttribute('height','4'); bar.setAttribute('rx','2');
    bar.setAttribute('fill', ribbonFill(ribbon));
    rg.append(circ,bar); svg.appendChild(rg);
    // roses
    const roses = document.createElementNS(svg.namespaceURI,'g');
    for(let i=0;i<qty;i++){
      const angle = (i/qty)*Math.PI*2;
      const cx = 100 + Math.cos(angle)*(28 + (i%3)*5) + (Math.random()*6-3);
      const cy = 120 + Math.sin(angle)*(18 + (i%2)*5) + (Math.random()*6-3);
      const c = document.createElementNS(svg.namespaceURI,'circle');
      c.setAttribute('cx',cx); c.setAttribute('cy',cy); c.setAttribute('r',12);
      c.setAttribute('fill', colors[i%colors.length]);
      const swirl=document.createElementNS(svg.namespaceURI,'path');
      swirl.setAttribute('d',`M ${cx-6} ${cy} q 6 -8 12 0 q -6 8 -12 0`);
      swirl.setAttribute('stroke','#9a2d62'); swirl.setAttribute('opacity','.3'); swirl.setAttribute('fill','none');
      roses.append(c,swirl);
    }
    svg.appendChild(roses);
    return svg;
  }

  // بناء بطاقات الباقات الجاهزة
  const grid = document.getElementById('readyGrid');
  readyData.forEach((cfg,i)=>{
    const card = document.createElement('div'); card.className='card';
    const img = document.createElement('div'); img.className='img';
    img.appendChild( makeBouquetSVG(cfg, 14 + (i%5)) );
    const body = document.createElement('div'); body.className='body';
    body.innerHTML = `<div style="display:flex;align-items:center;justify-content:space-between;gap:8px">
      <div><strong>${cfg.title}</strong><div class="mini">اختلاف بالتغليف والشريط</div></div>
      <div class="price">2000 د.ع/وردة</div>
    </div>
    <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">
      <span class="chip">تغليف: ${document.querySelector('#wrap option[value="'+cfg.wrap+'"]').textContent}</span>
      <span class="chip">شريط: ${cfg.ribbon==='gold'?'ذهبي':(cfg.ribbon==='silver'?'فضي':(cfg.ribbon==='pink'?'وردي':'أبيض'))}</span>
    </div>
    <div style="margin-top:10px;display:flex;gap:8px">
      <button class="btn" data-buy-ready="${i}" style="background:#ff77a6">اشتري الآن</button>
      <button class="btn" data-add-ready="${i}">أضف للسلة</button>
    </div>`;
    card.append(img,body); grid.appendChild(card);
  });

  //— التخصيص
  const qtyEl = document.getElementById('qty');
  const wrapEl = document.getElementById('wrap');
  const ribbonEl = document.getElementById('ribbon');
  const rosesG = document.getElementById('roses');
  const stemsG = document.getElementById('stems');
  const wrapPath = document.getElementById('wrapPath');
  const ribbonG = document.getElementById('ribbonG');

  // ألوان ورد للاختيار
  const ROSE_COLORS = [
    {name:'أحمر', hex:'#ff4b6e'},
    {name:'وردي', hex:'#ffa3c6'},
    {name:'وردي فاتح', hex:'#ffd1e4'},
    {name:'أبيض', hex:'#fff5f7'},
    {name:'أصفر', hex:'#ffd54f'},
    {name:'بنفسجي', hex:'#c083d3'},
    {name:'أزرق فاتح', hex:'#8ec5ff'}
  ];
  const swatchesWrap = document.getElementById('roseSwatches');
  const activeColors = new Set(['#ffa3c6']); // الافتراضي

  ROSE_COLORS.forEach(c=>{
    const b=document.createElement('button');
    b.type='button'; b.className='swatch';
    b.style.background=c.hex; b.title=c.name; b.dataset.hex=c.hex;
    b.addEventListener('click',()=>{
      if(activeColors.has(c.hex)){ activeColors.delete(c.hex); b.dataset.active="false"; }
      else{
        if(activeColors.size>=3){ alert('يمكن اختيار حتى 3 ألوان للورد.'); return; }
        activeColors.add(c.hex); b.dataset.active="true";
      }
      updatePreview();
    });
    if(activeColors.has(c.hex)) b.dataset.active="true";
    swatchesWrap.appendChild(b);
  });

  function updatePreview(){
    const qty = Math.max(5, Math.min(100, parseInt(qtyEl.value||12)));
    qtyEl.value = qty;
    // stems
    stemsG.innerHTML='';
    for(let i=0;i<Math.min(qty,22);i++){
      const x = 70 + (i%6)*6 + Math.random()*6;
      const r = document.createElementNS('http://www.w3.org/2000/svg','rect');
      r.setAttribute('x', x); r.setAttribute('y', 120+Math.random()*8);
      r.setAttribute('width', 2); r.setAttribute('height', 80+Math.random()*12);
      r.setAttribute('fill', ['#2e7d32','#3d8a40'][i%2]);
      stemsG.appendChild(r);
    }
    // wrap
    wrapPath.setAttribute('fill', wrapColor(wrapEl.value));
    // ribbon
    ribbonG.querySelectorAll('*').forEach(el=>el.setAttribute('fill', ribbonFill(ribbonEl.value)));

    // roses
    const colors = Array.from(activeColors);
    rosesG.innerHTML='';
    for(let i=0;i<qty;i++){
      const angle = (i/qty)*Math.PI*2;
      const cx = 100 + Math.cos(angle)*(28 + (i%3)*5) + (Math.random()*6-3);
      const cy = 130 + Math.sin(angle)*(18 + (i%2)*5) + (Math.random()*6-3);
      const c = document.createElementNS('http://www.w3.org/2000/svg','circle');
      c.setAttribute('cx',cx); c.setAttribute('cy',cy); c.setAttribute('r',12);
      c.setAttribute('fill', colors[i%colors.length]);
      const swirl=document.createElementNS('http://www.w3.org/2000/svg','path');
      swirl.setAttribute('d',`M ${cx-6} ${cy} q 6 -8 12 0 q -6 8 -12 0`);
      swirl.setAttribute('stroke','#9a2d62'); swirl.setAttribute('opacity','.3'); swirl.setAttribute('fill','none');
      rosesG.append(c,swirl);
    }

    // summary + price
    document.getElementById('summaryQty').textContent = qty;
    document.getElementById('miniQty').textContent = qty;
    document.getElementById('summaryWrap').textContent = wrapEl.selectedOptions[0].textContent;
    document.getElementById('summaryRibbon').textContent = ribbonEl.selectedOptions[0].textContent;
    document.getElementById('summaryColors').textContent = colors.length? colors.map(h=>ROSE_COLORS.find(x=>x.hex===h).name).join('، '):'—';
    const total = qty * PRICE_PER_ROSE;
    document.getElementById('totalPrice').textContent = total.toLocaleString('ar-IQ') + ' د.ع';
  }
  qtyEl.addEventListener('input', updatePreview);
  wrapEl.addEventListener('change', updatePreview);
  ribbonEl.addEventListener('change', updatePreview);
  updatePreview();

  //— سلة مبسطة
  const drawer = document.getElementById('cartDrawer');
  document.getElementById('openCart').onclick=()=>drawer.classList.add('open');

  const cart = [];
  function refreshCart(){
    const lines = document.getElementById('cartLines');
    lines.innerHTML='';
    let total=0;
    cart.forEach((item,idx)=>{
      const row=document.createElement('div'); row.className='line';
      row.innerHTML=`<div>
         <div><strong>باقة مخصصة</strong> — ${item.qty} وردة</div>
         <div class="mini">ألوان: ${item.colors.map(h=>ROSE_COLORS.find(x=>x.hex===h)?.name||'').join('، ')} | تغليف: ${item.wrapTxt} | شريط: ${item.ribbonTxt}</div>
      </div>
      <div>
        <div class="price">${(item.qty*PRICE_PER_ROSE).toLocaleString('ar-IQ')} د.ع</div>
        <button style="margin-top:6px" class="btn" onclick="removeLine(${idx})">حذف</button>
      </div>`;
      lines.appendChild(row);
      total += item.qty * PRICE_PER_ROSE;
    });
    document.getElementById('cartTotal').textContent = total.toLocaleString('ar-IQ')+' د.ع';
  }
  window.removeLine = i => { cart.splice(i,1); refreshCart(); }

  function currentConfig(){
    return {
      qty: parseInt(qtyEl.value||12),
      colors: Array.from(activeColors),
      wrap: wrapEl.value,
      wrapTxt: wrapEl.selectedOptions[0].textContent,
      ribbon: ribbonEl.value,
      ribbonTxt: ribbonEl.selectedOptions[0].textContent
    }
  }

  document.getElementById('addToCart').onclick=()=>{
    cart.push(currentConfig()); refreshCart(); drawer.classList.add('open');
  };
  document.getElementById('buyNow').onclick=()=>{
    cart.push(currentConfig()); refreshCart(); drawer.classList.add('open');
    document.getElementById('checkout').scrollIntoView({behavior:'smooth'});
  };

  // أزرار الباقات الجاهزة
  document.querySelectorAll('[data-add-ready]').forEach(btn=>{
    btn.addEventListener('click',()=>{
      const cfg = readyData[parseInt(btn.dataset.addReady)];
      cart.push({qty:12, colors:cfg.colors, wrap:cfg.wrap, wrapTxt:document.querySelector('#wrap option[value="'+cfg.wrap+'"]').textContent, ribbon:cfg.ribbon, ribbonTxt:(cfg.ribbon==='gold'?'ذهبي':cfg.ribbon==='silver'?'فضي':cfg.ribbon==='pink'?'وردي':'أبيض')});
      refreshCart(); drawer.classList.add('open');
    });
  });
  document.querySelectorAll('[data-buy-ready]').forEach(btn=>{
    btn.addEventListener('click',()=>{
      const cfg = readyData[parseInt(btn.dataset.buyReady)];
      cart.push({qty:12, colors:cfg.colors, wrap:cfg.wrap, wrapTxt:document.querySelector('#wrap option[value="'+cfg.wrap+'"]').textContent, ribbon:cfg.ribbon, ribbonTxt:(cfg.ribbon==='gold'?'ذهبي':cfg.ribbon==='silver'?'فضي':cfg.ribbon==='pink'?'وردي':'أبيض')});
      refreshCart(); drawer.classList.add('open');
      document.getElementById('checkout').scrollIntoView({behavior:'smooth'});
    });
  });

  // دفع تجريبي
  document.getElementById('checkout').addEventListener('submit', (e)=>{
    e.preventDefault();
    alert('تم استلام طلبك بنجاح 🌷 سيتم التواصل للتأكيد والدفع.');
    drawer.classList.remove('open'); cart.length=0; refreshCart();
  });

  // دعم بسيط
  const chatBtn=document.getElementById('toggleChat');
  const chatBox=document.getElementById('chatBox');
  chatBtn.onclick=()=>chatBox.classList.toggle('open');
  document.getElementById('chatForm').addEventListener('submit', (e)=>{
    e.preventDefault();
    const input=document.getElementById('chatInput');
    if(!input.value.trim()) return;
    const div=document.createElement('div'); div.className='msg'; div.textContent=input.value;
    document.getElementById('messages').appendChild(div); input.value='';
    setTimeout(()=>{
      const reply=document.createElement('div'); reply.className='msg';
      reply.textContent='شكرًا لتواصلك! سنرد عليك خلال دقائق.';
      document.getElementById('messages').appendChild(reply);
    },600);
  });

</script>
</body>
</html>

